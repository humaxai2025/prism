<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{project_name}} - Requirements Analysis</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; margin: 0; padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #007bff; }
        .company-logo { font-size: 24px; font-weight: bold; color: #007bff; margin-bottom: 10px; }
        .report-title { font-size: 32px; margin: 10px 0; color: #333; }
        .metadata { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 20px 0; padding: 20px; background-color: #f8f9fa; border-radius: 6px; }
        .metric { text-align: center; }
        .metric-value { font-size: 24px; font-weight: bold; color: #007bff; }
        .metric-label { font-size: 12px; text-transform: uppercase; color: #666; margin-top: 5px; }
        .executive-summary { background: #e7f3ff; padding: 20px; border-left: 4px solid #007bff; margin: 20px 0; }
        .severity-critical { color: #dc3545; }
        .severity-high { color: #fd7e14; }
        .severity-medium { color: #ffc107; }
        .severity-low { color: #28a745; }
        .section { margin: 30px 0; }
        .section-title { font-size: 24px; color: #333; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; margin-bottom: 20px; }
        .ambiguity-item { background: white; border-left: 4px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .ambiguity-critical { border-left-color: #dc3545; }
        .ambiguity-high { border-left-color: #fd7e14; }
        .ambiguity-medium { border-left-color: #ffc107; }
        .ambiguity-low { border-left-color: #28a745; }
        .chart-container { margin: 20px 0; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6; }
        th { background-color: #f8f9fa; font-weight: 600; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #dee2e6; text-align: center; color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="company-logo">{{company_name}}</div>
            <h1 class="report-title">{{project_name}} Requirements Analysis</h1>
            <p>Generated on {{timestamp}} | PRISM v{{version}}</p>
            {{#if stakeholder}}<p><strong>Primary Stakeholder:</strong> {{stakeholder}}</p>{{/if}}
        </div>

        <!-- Executive Summary -->
        <div class="executive-summary">
            <h2>üìä Executive Summary</h2>
            <div class="metadata">
                <div class="metric">
                    <div class="metric-value">{{len requirements}}</div>
                    <div class="metric-label">Requirements Analyzed</div>
                </div>
                <div class="metric">
                    <div class="metric-value">{{len ambiguities}}</div>
                    <div class="metric-label">Issues Identified</div>
                </div>
                <div class="metric">
                    <div class="metric-value">{{#if completeness_score}}{{completeness_score}}%{{else}}--{{/if}}</div>
                    <div class="metric-label">Completeness Score</div>
                </div>
            </div>
            
            {{#if executive_summary_text}}
            <p>{{executive_summary_text}}</p>
            {{else}}
            <p>This analysis identified {{len ambiguities}} {{pluralize (len ambiguities) "issue" "issues"}} across {{len requirements}} {{pluralize (len requirements) "requirement" "requirements"}}. 
            {{#if (gt (len ambiguities) 0)}}Immediate attention is recommended for critical and high-severity issues to ensure project success.{{else}}All requirements appear well-defined and ready for implementation.{{/if}}</p>
            {{/if}}
        </div>

        {{#if ambiguities}}
        <!-- Issues Analysis -->
        <div class="section">
            <h2 class="section-title">‚ö†Ô∏è Issues Analysis</h2>
            
            <!-- Severity Breakdown -->
            <div class="chart-container">
                <table>
                    <thead>
                        <tr>
                            <th>Severity</th>
                            <th>Count</th>
                            <th>Percentage</th>
                            <th>Action Required</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="severity-critical">üî¥ Critical</span></td>
                            <td>{{count_by_severity ambiguities "Critical"}}</td>
                            <td>{{percentage_by_severity ambiguities "Critical"}}%</td>
                            <td>Immediate resolution required</td>
                        </tr>
                        <tr>
                            <td><span class="severity-high">üü† High</span></td>
                            <td>{{count_by_severity ambiguities "High"}}</td>
                            <td>{{percentage_by_severity ambiguities "High"}}%</td>
                            <td>Address before implementation</td>
                        </tr>
                        <tr>
                            <td><span class="severity-medium">üü° Medium</span></td>
                            <td>{{count_by_severity ambiguities "Medium"}}</td>
                            <td>{{percentage_by_severity ambiguities "Medium"}}%</td>
                            <td>Should be addressed</td>
                        </tr>
                        <tr>
                            <td><span class="severity-low">üü¢ Low</span></td>
                            <td>{{count_by_severity ambiguities "Low"}}</td>
                            <td>{{percentage_by_severity ambiguities "Low"}}%</td>
                            <td>Consider for improvement</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Detailed Issues -->
            {{#each ambiguities}}
            <div class="ambiguity-item ambiguity-{{lowercase severity}}">
                <h3>Issue #{{@index}}: "{{text}}"</h3>
                <p><strong>Severity:</strong> <span class="severity-{{lowercase severity}}">{{severity}}</span></p>
                <p><strong>Problem:</strong> {{reason}}</p>
                <p><strong>Recommendations:</strong></p>
                <ul>
                    {{#each suggestions}}
                    <li>{{this}}</li>
                    {{/each}}
                </ul>
            </div>
            {{/each}}
        </div>
        {{/if}}

        {{#if improved_requirements}}
        <!-- Improved Requirements -->
        <div class="section">
            <h2 class="section-title">‚ú® Improved Requirements</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 6px;">
                {{{improved_requirements}}}
            </div>
        </div>
        {{/if}}

        {{#if entities}}
        <!-- Entity Analysis -->
        <div class="section">
            <h2 class="section-title">üéØ Entity Analysis</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                {{#if entities.actors}}
                <div>
                    <h3>üë• Actors ({{len entities.actors}})</h3>
                    <ul>
                        {{#each entities.actors}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}

                {{#if entities.actions}}
                <div>
                    <h3>‚ö° Actions ({{len entities.actions}})</h3>
                    <ul>
                        {{#each entities.actions}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}

                {{#if entities.objects}}
                <div>
                    <h3>üì¶ Objects ({{len entities.objects}})</h3>
                    <ul>
                        {{#each entities.objects}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}
            </div>
        </div>
        {{/if}}

        <!-- Recommendations -->
        <div class="section">
            <h2 class="section-title">üìã Recommendations</h2>
            <div style="background: #e7f3ff; padding: 20px; border-radius: 6px;">
                {{#if (gt (count_by_severity ambiguities "Critical") 0)}}
                <p><strong>üî¥ Immediate Action Required:</strong> {{count_by_severity ambiguities "Critical"}} critical {{pluralize (count_by_severity ambiguities "Critical") "issue" "issues"}} must be resolved before proceeding with development.</p>
                {{/if}}
                
                {{#if (gt (count_by_severity ambiguities "High") 0)}}
                <p><strong>üü† High Priority:</strong> Address {{count_by_severity ambiguities "High"}} high-severity {{pluralize (count_by_severity ambiguities "High") "issue" "issues"}} in the next planning cycle.</p>
                {{/if}}
                
                {{#if (lt (len ambiguities) 3)}}
                <p><strong>‚úÖ Quality Assessment:</strong> Requirements quality is good with minimal issues identified.</p>
                {{else if (lt (len ambiguities) 6)}}
                <p><strong>‚ö†Ô∏è Quality Assessment:</strong> Requirements quality is moderate. Consider review and refinement.</p>
                {{else}}
                <p><strong>üîÑ Quality Assessment:</strong> Requirements need significant improvement before implementation.</p>
                {{/if}}
                
                <p><strong>Next Steps:</strong></p>
                <ul>
                    <li>Review and address all critical and high-severity issues</li>
                    <li>Validate improved requirements with stakeholders</li>
                    <li>Use generated UML diagrams for system design</li>
                    <li>Implement suggested test cases during development</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Generated by PRISM v{{version}} - AI-Powered Requirements Analyzer</p>
            {{#if branding}}<p>{{branding}}</p>{{/if}}
        </div>
    </div>
</body>
</html>